<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="tdf.extensionsuploadcenter">


<head>
    <metal:block fill-slot="top_slot">
        <tal:noborder condition="python:not user.has_permission('Modify portal content', context)">
            <tal:noborderset tal:define="dummy python:request.set('disable_border', 1)" />
        </tal:noborder>
    </metal:block>
</head>


<body>

<metal:main fill-slot="main">
    <tal:main-macro metal:define-macro="main"
            tal:define="toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                        currentCategory request/getCategories |string:;
                        currentVersion request/getCompatibility |view/get_latest_program_release;
                        SearchableText request/SearchableText | string:;
                        sort_on   request/sort_on | string:positive_ratings;
                        cropText nocall:context/@@plone/cropText;
                        catalog nocall:context/portal_catalog;
                        toLocalizedTime nocall:context/@@plone/toLocalizedTime;">

        <div class="grid-row">
            <div class="grid-cell position-two-thirds width-third">
                	<div class="splash pullout" id="sidebar-downloads">
                        	<h1 tal:condition="context/product_title" i18n:translate="">
                                <span tal:content="context/product_title" i18n:name="product_title" />
                            </h1>
                        	<h1 tal:condition="not:context/product_title" i18n:translate="">Extensions</h1>
                        	<span tal:content="structure context/addon_description | nothing"/>
                        <p class="current-projects" i18n:translate="">Currently there are
                            <span tal:content="view/eupproject_count" i18n:name="eup_project_count" /> projects with
                            <span tal:content="view/euprelease_count" /> releases available.</p>
                        <a class="pointer" tal:attributes="href string:${context/absolute_url}/++add++tdf.extensionsuploadcenter.eupproject" i18n:translate="">Submit your <span tal:content="context/product_title | string:extension_project" i18n:name="product_title_eupproject" /></a>


                	</div>
            </div>
        </div>
        <div class="grid-row">
            <div class="grid-cell position-leftmost width-two-thirds">
                <div class="paneeuc">
                    	<h2 tal:condition="context/product_title" i18n:translate="">
                            <span tal:content="context/product_title" i18n:name="product_title" /> Releases
                        </h2>
                    <h2 tal:condition="not:context/product_title" i18n:translate="">Extensions</h2>
                    	<div id="sort-by">
                            	<form id="product_select" style="margin-bottom: 1em" tal:attributes="action string:${context/absolute_url}">
                                    <label class="hiddenStructure" i18n:translate="">Show</label>
                                    	<select name="getCategories" onchange="this.form.submit()">
                                            <option value="" i18n:translate="">All categories</option>
                                            <tal:block tal:repeat="cat context/available_category">
                                                <option tal:define="csplit python:[s.strip() for s in cat.split('|')]; cid python:csplit[0]"
                                                        tal:content="python:csplit[0]"
                                                        tal:attributes="value cid; selected python:(cid==currentCategory,'selected',nothing)" />
                                            </tal:block>
                                    	</select>
                                       <select name="getCompatibility" onchange="this.form.submit()">
                                           <tal:block tal:repeat="version context/available_versions">
                                               <option tal:content="version"
                                                        tal:attributes="value version;
                                                                       selected python:(currentVersion==version,'selected',nothing)">

                                               </option>
                                           </tal:block>
                                       </select>
                                    <label for="project-sort" i18n:translate="">Sort On</label>
                                    <select name="sort_on" id="project-sort" onchange="this.form.submit()">
                                        <tal:comment replace="nothing">Featured items are sorted by rating</tal:comment>
                                        <option value="positive_ratings" tal:attributes="selected    python:sort_on == 'positive_ratings' and 'selected' "i18n:translate="">Highest Rated</option>
                                        <option value="created" tal:attributes="selected    python:sort_on == 'created' and 'selected' or ''" i18n:translate="">Newest</option>
                                    </select>
                                    <input type="hidden" name="path" tal:attributes="value python:'/'.join(context.getPhysicalPath())" /> &nbsp;
                                    <input type="hidden" name="portal_type" value="EUpProject" />
                                    <input type="search" name="SearchableText" tal:attributes="value SearchableText" value="" class="inputLabel" size="20"                                              />
                                    <input type="submit" value="Search" i18n:attributes="value" />
                            	</form>
                    	</div>


                    <div class="" id="categories"
                            tal:define="results python:view.get_products(currentCategory, currentVersion, sort_on, SearchableText);
                                        Batch python:modules['Products.CMFPlone'].Batch;
				                        b_size python:10;b_start python:0;b_start request/b_start | b_start;
				                        desc_length site_properties/search_results_description_length;
				                        desc_ellipsis site_properties/ellipsis;">
                        <p tal:condition="not: results">
                            <strong i18n:translate="description_no_results_found">No results were found.</strong>
                        </p>
                        <p id="numreleases" i18n:translate="">
                            <span tal:replace="python:len(results)" i18n:name="results_eupprojects">234</span> projects matching your criteria.
                        </p>
                        <tal:results condition="results"
                                     define="batch python:Batch(results, b_size, int(b_start), orphan=1);">
                            <ul class="downloads">
                               <li tal:repeat="result batch">
                                   <tal:entry
						                define="obj result/getObject;
						                project python:obj.aq_parent;
						                url result/getURL;
							            projectURL project/absolute_url;
							            result_type result/portal_type;
							            zoomid   python:project.id.replace('.', '_');
							            screenshot   project/getScreenshot | nothing">
                                       <h3 style="border-top: none">
                                           <a href="" tal:attributes="href projectURL;" 	tal:content="project/pretty_title_or_id">
								           <tal:comment replace="nothing">Product One</tal:comment></a>
                                       </h3>
                                       <div tal:content="structure project/@@rate-if-you-dare"/>
                                       <div class="project-thumb thumbzoom" tal:condition="screenshot">
                                           <a tal:attributes="href projectURL">
                                               <img tal:condition="project/screenshot|nothing" tal:replace="structure project/screenshot" />
                                           </a>
                                       </div>
                                       <span class="project-thumb" tal:condition="not:screenshot">
                                           <img tal:condition="project/logo|nothing" tal:replace="structure project/logo" />
                                       </span>
                                       <div class="product-details">
                                           <span class="product-leadin"></span>
                                           <p class="product-description"
								tal:content="python:cropText(project.Description(), desc_length, desc_ellipsis)">
								<tal:comment replace="nothing">Project Description.</tal:comment>
							</p>

<div class="project-compatibilities"
							     tal:define="compatibilities python:result.compatibility_choice;"
							     tal:condition="compatibilities">
							     Latest extension file compatible with:

							     <tal:loop   repeat="compatibility compatibilities">
							         <span class="project-compatibility">
							             <span tal:content="compatibility" tal:omit-tag="python:True"/>
							             <span tal:condition="not:repeat/compatibility/end"
							                                  tal:omit-tag="python:True">, </span>
							         </span>

							     </tal:loop>

							</div>


							            </tal:entry>
                               </li>
                            </ul>

                        </tal:results>




				    </div>

                </div>
            </div>


	<div class="grid-cell position-two-thirds width-third">
		<div class="sidebar">
            <h2 i18n:translate="">Most recent <span tal:content="context/product_title" i18n:name="product_title" /></h2>

            <div class="" id="mostrecent"
                            tal:define="results python:view.get_newest_products();
                                        Batch python:modules['Products.CMFPlone'].Batch;
				                        b_size python:10;b_start python:0;b_start request/b_start | b_start;
				                        desc_length site_properties/search_results_description_length;
				                        desc_ellipsis site_properties/ellipsis;">
                <tal:results condition="results"
                                     define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

                    <ul class="downloads">
                        <li tal:repeat="result batch">
                          <tal:entry
						                define="project result/getObject;

						                url result/getURL;
							            projectURL project/absolute_url;
							            result_type result/portal_type;
							            zoomid   python:project.id.replace('.', '_');
							            screenshot   project/getScreenshot | nothing">

                              <h3 style="border-top: none">
                                           <a href="" tal:attributes="href projectURL;" 	tal:content="project/pretty_title_or_id">
								           <tal:comment replace="nothing">Product One</tal:comment></a>
                                       </h3>

						  </tal:entry>

                        </li>

                    </ul>





                </tal:results>



		    </div>

            <h2 i18n:translate="">Most popular <span tal:content="context/product_title" i18n:name="product_title" /></h2>

            <div class="" id="mostpopular"
                            tal:define="results python:view.get_most_popular_products();
                                        Batch python:modules['Products.CMFPlone'].Batch;
				                        b_size python:10;b_start python:0;b_start request/b_start | b_start;
				                        desc_length site_properties/search_results_description_length;
				                        desc_ellipsis site_properties/ellipsis;">
                <tal:results condition="results"
                                     define="batch python:Batch(results, b_size, int(b_start), orphan=1);">

                    <ul class="downloads">
                        <li tal:repeat="result batch">
                          <tal:entry
						                define="project result/getObject;

						                url result/getURL;
							            projectURL project/absolute_url;
							            result_type result/portal_type;
							            zoomid   python:project.id.replace('.', '_');
							            screenshot   project/getScreenshot | nothing">

                              <h3 style="border-top: none">
                                           <a href="" tal:attributes="href projectURL;" 	tal:content="project/pretty_title_or_id">
								           <tal:comment replace="nothing">Product One</tal:comment></a>
                                       </h3>

						  </tal:entry>

                        </li>

                    </ul>





                </tal:results>



		    </div>

			<h2 tal:condition="context/product_title" i18n:translate="">
				Browse <span tal:content="context/product_title" i18n:name="product_title" /> by Category
			</h2>
			<h2 tal:condition="not:context/product_title" i18n:translate="">Browse Extensions by Category</h2>

			<ol id="add-on-categories">
				<tal:categories repeat="cat context/available_category">

                <li><a href=""
                tal:define="csplit python:[s.strip() for s in cat.split('|')]; cid python:csplit[0]"
                tal:attributes="href string:${context/absolute_url}?getCategories=${cid}&getCompatibility=any"
                tal:content="python:csplit[0]"
                ><tal:comment replace="nothing">LibreOffice extensions</tal:comment></a></li>
				</tal:categories>
			</ol>

		</div>
        <div tal:condition="context/install_instructions">
            <h3>Install Instructions</h3>
            <span tal:content="structure context/install_instructions/output" />

        </div>
        <div tal:condition="context/reporting_bugs">
            <h3>Reporting Extension-Bugs</h3>
            <span tal:content="structure context/reporting_bugs/output" />
        </div>
        <div tal:condition="context/product_description">
            <h3>About</h3>
            <span tal:content="structure context/product_description" />
        </div>


    </div>

</tal:main-macro>
</metal:main>

</body>
</html>